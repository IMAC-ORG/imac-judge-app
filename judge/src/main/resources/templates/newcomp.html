<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
  <title>Competition Setup</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="materialize/css/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection" />
  <link href="materialize/css/nouislider.css" type="text/css" rel="stylesheet" />
  <style>
    .carousel {
      height: 100vh;
    }

    .pilot_class {
      font-size: calc(6vw + 3vh) !important;
    }

    .pilot_name {
      font-size: calc(1vw + 2vh) !important;
    }

    .pilot_round {
      font-size: calc(1vw + 2vh) !important;
    }

    @font-face {
      font-family: digitalFont;
      src: url(font/digital-7.ttf);
    }
  </style>
</head>

<body>
  <div class="section no-pad-bot yellow" id="index-banner">
    <div class="container yellow black-text">
      <div class="row">
        <div class="col s12"><h5 class="light pilot_round">Competition Rounds</h5></div>
        
      </div>
      <div class="row">
        <div class="col s12"><div class="black"id="round-slider"></div></div>
      </div>
      <div class="row center">
        <div class="col s4"><h5 class="pilot_round">Known Sequences PR</h5></div>
        <div class="col s4 offset-s4"><h5 class="pilot_round">Unknown Sequences PR</h5></div>
      </div>
      <div class="row">
        <div class="col s4"><div class="black"id="sequence-slider"></div></div>
        <div class="col s4 offset-s4"><div class="black" id="unknown-sequence-slider"></div></div>
      </div>
      <br>
      <div th:if="${isCurrentComp}">
        <div class="switch center">
          <label class="black-text">
            New
            <input type="checkbox" id="checkbox">
            <span class="lever black"></span>
            Update
          </label>
        </div>
      </div>
      <br>
      <div class="row center">
        <a href="#" id="createComp" class="waves-effect waves-light btn orange darken-1 pulse">Start</a>
      </div>
      <br>
    </div>
  </div>
  <div class="fixed-action-btn">
    <a class="btn-floating btn-large red">
      <i class="large material-icons">menu</i>
    </a>
    <ul>
      <li><a class="btn-floating btn-large green" href="/"><i class="material-icons">home</i></a></li>
    </ul>
  </div>


  <!--  Scripts-->
  <script src="jquery-3.6.4.min.js"></script>
  <script src="materialize/js/materialize.js"></script>
  <script src="materialize/js/nouislider.js"></script>
  <script th:inline="javascript">
    /*<![CDATA[*/
    var roundslider = document.getElementById('round-slider');
    var sequenceslider = document.getElementById('sequence-slider');
    var unknownsequenceslider = document.getElementById('unknown-sequence-slider');
    var valuesForRoundSlider = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50]; // 16 values
    var valuesForSequenceSlider = [1, 2]; // 16 values
    var valuesForUnknownSequenceSlider = [0, 1, 2]; // 16 values

    const isCurrentComp = /*[[${isCurrentComp}]]*/ ;
    const currentRound = /*[[${currentRounds}]]*/ ;
    const currentSequences = /*[[${currentSequences}]]*/ ;
    const currentUnknownSequences = /*[[${currentUnknownSequences}]]*/ ;

    document.addEventListener('DOMContentLoaded', function () {
      var elems = document.querySelectorAll('.fixed-action-btn');
      var instances = M.FloatingActionButton.init(elems, {
        hoverEnabled: false
      });
    });

    console.log(isCurrentComp);
    console.log(currentRound);
    var format = {
      to: function (value) {
        return valuesForRoundSlider[Math.round(value)];
      },
      from: function (value) {
        return valuesForRoundSlider.indexOf(Number(value));
      }

    };
    var seqformat = {
      to: function (value) {
        return valuesForSequenceSlider[Math.round(value)];
      },
      from: function (value) {
        return valuesForSequenceSlider.indexOf(Number(value));
      }

    };

    var unknownseqformat = {
      to: function (value) {
        return valuesForUnknownSequenceSlider[Math.round(value)];
      },
      from: function (value) {
        return valuesForUnknownSequenceSlider.indexOf(Number(value));
      }

    };
    noUiSlider.create(roundslider, {
      start: 50,
      // A linear range from 0 to 15 (16 values)
      range: { min: 0, max: 49 },
      // steps of 1
      step: 1,
      tooltips: true,
      format: format,
      //pips: { mode: 'steps', format: format },
    });
    noUiSlider.create(sequenceslider, {
      start: 2,
      // A linear range from 0 to 15 (16 values)
      range: { min: 0, max: 1 },
      // steps of 1
      step: 1,
      tooltips: true,
      format: seqformat,
     //pips: { mode: 'steps', format: seqformat },
    });
    noUiSlider.create(unknownsequenceslider, {
      start: 0,
      // A linear range from 0 to 15 (16 values)
      range: { min: 0, max: 2 },
      // steps of 1
      step: 1,
      tooltips: true,
      format: unknownseqformat,
      //pips: { mode: 'steps', format: unknownseqformat },
    });

    if (isCurrentComp) {
      roundslider.noUiSlider.set(currentRound);
      sequenceslider.noUiSlider.set(currentSequences);
      unknownsequenceslider.noUiSlider.set(currentUnknownSequences);
      $('#checkbox').attr('checked','checked')
    }

    $("#createComp").click(function () {
      console.log($('#checkbox').is(":checked"));
      var editComp = $('#checkbox').is(":checked");
      var rounds = roundslider.noUiSlider.get();
      var sequences = sequenceslider.noUiSlider.get();
      var unknownSequences = unknownsequenceslider.noUiSlider.get();
      $.ajax({
        type: "POST",
        url: "/api/comp?edit=" + editComp,
        // The key needs to match your method's input parameter (case-sensitive).
        data: JSON.stringify(
          { rounds: rounds, sequences: sequences, unknown_sequences: unknownSequences }
        ),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function (data) {
          window.location = "/"
        },
        error: function (errMsg) {
          alert(errMsg);
        }
      });
    });

    /*]]>*/
  </script>

</body>

</html>